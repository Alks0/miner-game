# æŒ–çŸ¿æ¸¸æˆ - è¯¦ç»†å¼€å‘è®¡åˆ’

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [å‰ç«¯å¼€å‘è®¡åˆ’](#å‰ç«¯å¼€å‘è®¡åˆ’)
4. [åç«¯å¼€å‘è®¡åˆ’](#åç«¯å¼€å‘è®¡åˆ’)
5. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
6. [APIæ¥å£è®¾è®¡](#APIæ¥å£è®¾è®¡)
7. [å¼€å‘é˜¶æ®µè§„åˆ’](#å¼€å‘é˜¶æ®µè§„åˆ’)
8. [éƒ¨ç½²ä¸è¿ç»´](#éƒ¨ç½²ä¸è¿ç»´)

---

## é¡¹ç›®æ¦‚è¿°

### ğŸ® æ¸¸æˆç®€ä»‹
ä¸€æ¬¾ä»¥çŸ¿å·¥ä¸ºä¸»é¢˜çš„ä¼‘é—²æŒ‚æœºç±»H5æ¸¸æˆï¼Œèåˆäº†æ”¾ç½®æŒ‚æœºã€é“å…·åˆæˆã€PVPæ å¤ºã€è™šæ‹Ÿäº¤æ˜“æ‰€ç­‰å¤šç§ç©æ³•ã€‚

### ğŸ¯ æ ¸å¿ƒç©æ³•
- **æŒ–çŸ¿ç³»ç»Ÿ**ï¼šè‡ªåŠ¨äº§å‡ºèµ„æºï¼Œå…·æœ‰æš´å‡»å’Œåå¡Œæœºåˆ¶
- **é“å…·ç³»ç»Ÿ**ï¼šçŸ¿æœºã€çŸ¿è½¦ã€æ å¤ºå™¨ã€é˜²å¾¡ç›¾ç­‰å¤šç§å¯å‡çº§é“å…·
- **åˆæˆå‡çº§**ï¼šç¢ç‰‡åˆæˆé“å…·ï¼Œé“å…·å¯å‡çº§å¼ºåŒ–
- **æ å¤ºç³»ç»Ÿ**ï¼šPVPç©æ³•ï¼Œå¯æ å¤ºå…¶ä»–ç©å®¶èµ„æº
- **äº¤æ˜“æ‰€**ï¼šç©å®¶é—´è‡ªç”±äº¤æ˜“é“å…·çš„è™šæ‹Ÿå¸‚åœº
- **èµ›å­£åˆ¶**ï¼šå®šæœŸé‡ç½®æ’è¡Œæ¦œï¼Œå¢å¼ºç«äº‰æ€§

### ğŸ’° å•†ä¸šæ¨¡å¼
- æ¿€åŠ±è§†é¢‘å¹¿å‘Šï¼ˆä¸»è¦æ”¶å…¥æ¥æºï¼‰
- å…å¹¿å‘Šç‰¹æƒä»˜è´¹
- é“å…·ç¤¼åŒ…ä»˜è´¹

---

## æŠ€æœ¯æ¶æ„

### ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å®¢æˆ·ç«¯å±‚ (Client)                    â”‚
â”‚              Cocos Creator 3.x (H5/å°ç¨‹åº)             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ ä¸»ç•Œé¢   â”‚ ä»“åº“ç•Œé¢ â”‚ æ å¤ºç•Œé¢ â”‚ äº¤æ˜“æ‰€   â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTPS/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APIç½‘å…³å±‚ (Gateway)                  â”‚
â”‚               èº«ä»½éªŒè¯ / é™æµ / è·¯ç”±                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 åº”ç”¨æœåŠ¡å±‚ (Backend)                   â”‚
â”‚                  NestJS (Node.js)                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ç”¨æˆ·æœåŠ¡  â”‚æ¸¸æˆæœåŠ¡  â”‚äº¤æ˜“æœåŠ¡  â”‚é€šçŸ¥æœåŠ¡  â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å±‚ (Database)                    â”‚
â”‚         PostgreSQL (ä¸»åº“)    +    Redis (ç¼“å­˜)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“š æŠ€æœ¯é€‰å‹è¯¦è§£

#### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|-----|------|------|---------|
| Cocos Creator | 3.8.x | æ¸¸æˆå¼•æ“ | ä¸“ä¸šH5æ¸¸æˆå¼•æ“ï¼ŒUIä¸è·¨å¹³å°è¡¨ç°ç¨³å®š |
| TypeScript | 5.x | å¼€å‘è¯­è¨€ | ç±»å‹å®‰å…¨ï¼Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ |
| Effect Shader/Material | å†…ç½® | UIç‰¹æ•ˆ | å®ç°ç´«è“æ¸å˜ã€éœ“è™¹æè¾¹ã€å‘å…‰ã€æ¨¡ç³Šç­‰ç§‘æŠ€é£æ•ˆæœ |
| SDF Font | - | æ•°å­—å­—ä½“ | é«˜åˆ†è¾¨ç‡ç¼©æ”¾æ¸…æ™°ï¼Œé€‚åˆå¤§æ•°å­—æ˜¾ç¤º |
| Tween.js | å†…ç½® | ç¼“åŠ¨åŠ¨ç”» | æ•°å€¼è¿‡æ¸¡ã€å¡ç‰‡æ»‘å…¥ç­‰è½»é‡åŠ¨ç”» |
| Graphics | å†…ç½® | å¯è§†åŒ– | æŠ˜çº¿/ç¯å½¢è¿›åº¦ã€æŒ‡æ ‡æ›²çº¿æ— DOMä¾èµ– |

**å‰ç«¯ç›®å½•ç»“æ„**
```
assets/
â”œâ”€â”€ scripts/              # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ GameManager.ts      # æ¸¸æˆç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ NetworkManager.ts   # ç½‘ç»œç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ AudioManager.ts     # éŸ³é¢‘ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ EventManager.ts     # äº‹ä»¶ç®¡ç†å™¨
â”‚   â”œâ”€â”€ scenes/          # åœºæ™¯è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ MainScene.ts        # ä¸»ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ WarehouseScene.ts   # ä»“åº“ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ PlunderScene.ts     # æ å¤ºç•Œé¢
â”‚   â”‚   â””â”€â”€ ExchangeScene.ts    # äº¤æ˜“æ‰€ç•Œé¢
â”‚   â”œâ”€â”€ components/      # ç»„ä»¶è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ ui/                 # UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ game/               # æ¸¸æˆç»„ä»¶
â”‚   â”‚   â””â”€â”€ items/              # é“å…·ç»„ä»¶
â”‚   â”œâ”€â”€ data/            # æ•°æ®å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ PlayerData.ts       # ç©å®¶æ•°æ®
â”‚   â”‚   â”œâ”€â”€ ItemData.ts         # é“å…·æ•°æ®
â”‚   â”‚   â””â”€â”€ GameConfig.ts       # æ¸¸æˆé…ç½®
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ resources/           # åŠ¨æ€èµ„æº
â”‚   â”œâ”€â”€ prefabs/        # é¢„åˆ¶ä»¶
â”‚   â”œâ”€â”€ sprites/        # å›¾æ ‡ã€èƒŒæ™¯å›¾
â”‚   â”œâ”€â”€ fonts/          # å­—ä½“ï¼ˆç§‘æŠ€æ„Ÿæ•°å­—å­—ä½“ï¼‰
â”‚   â”œâ”€â”€ materials/      # æè´¨ï¼ˆæ¸å˜/å‘å…‰/æè¾¹/æ¨¡ç³Šï¼‰
â”‚   â”œâ”€â”€ shaders/        # Effect( .effect/.chunk ) è‡ªå®šä¹‰ç‰¹æ•ˆ
â”‚   â”œâ”€â”€ themes/         # ä¸»é¢˜å˜é‡ï¼ˆcolors.jsonã€radius.jsonï¼‰
â”‚   â””â”€â”€ audio/          # éŸ³æ•ˆï¼ˆå¯é€‰ï¼‰
â””â”€â”€ scenes/             # åœºæ™¯æ–‡ä»¶
```

#### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|-----|------|------|---------|
| Node.js | 20.x LTS | è¿è¡Œç¯å¢ƒ | é«˜æ€§èƒ½å¼‚æ­¥I/Oï¼Œä¸å‰ç«¯æŠ€æœ¯æ ˆç»Ÿä¸€ |
| NestJS | 10.x | Webæ¡†æ¶ | ä¼ä¸šçº§æ¶æ„ï¼Œæ¨¡å—åŒ–è®¾è®¡ï¼ŒTypeScriptåŸç”Ÿæ”¯æŒ |
| TypeORM | 0.3.x | ORMæ¡†æ¶ | ç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œï¼Œæ”¯æŒè¿ç§» |
| PostgreSQL | 15.x | å…³ç³»æ•°æ®åº“ | ACIDä¿è¯ï¼Œé€‚åˆäº¤æ˜“ç­‰å¼ºä¸€è‡´æ€§åœºæ™¯ |
| Redis | 7.x | ç¼“å­˜/æ¶ˆæ¯é˜Ÿåˆ— | é«˜æ€§èƒ½ç¼“å­˜ï¼Œæ”¯æŒæ’è¡Œæ¦œã€ä¼šè¯ç®¡ç† |
| Socket.io | 4.x | WebSocket | å®æ—¶é€šè®¯ï¼Œå…¼å®¹æ€§å¥½ |
| JWT | 9.x | è®¤è¯æˆæƒ | æ— çŠ¶æ€è®¤è¯ï¼Œæ˜“äºæ‰©å±• |
| Bull | 4.x | ä»»åŠ¡é˜Ÿåˆ— | å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆå¦‚æŒ–çŸ¿äº§å‡ºè®¡ç®—ï¼‰ |

**åç«¯ç›®å½•ç»“æ„**
```
src/
â”œâ”€â”€ main.ts                    # åº”ç”¨å…¥å£
â”œâ”€â”€ app.module.ts              # æ ¹æ¨¡å—
â”œâ”€â”€ common/                    # é€šç”¨æ¨¡å—
â”‚   â”œâ”€â”€ decorators/           # è£…é¥°å™¨
â”‚   â”œâ”€â”€ filters/              # å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ guards/               # å®ˆå«
â”‚   â”œâ”€â”€ interceptors/         # æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ pipes/                # ç®¡é“
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”œâ”€â”€ config/                    # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ database.config.ts
â”‚   â”œâ”€â”€ redis.config.ts
â”‚   â””â”€â”€ game.config.ts
â”œâ”€â”€ modules/                   # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ auth/                 # è®¤è¯æˆæƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ strategies/       # JWT/å¾®ä¿¡ç™»å½•ç­–ç•¥
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ user/                 # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”œâ”€â”€ user.module.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ gameplay/             # æ¸¸æˆç©æ³•æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ mine/            # æŒ–çŸ¿å­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ item/            # é“å…·å­æ¨¡å—
â”‚   â”‚   â””â”€â”€ plunder/         # æ å¤ºå­æ¨¡å—
â”‚   â”œâ”€â”€ exchange/             # äº¤æ˜“æ‰€æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ exchange.controller.ts
â”‚   â”‚   â”œâ”€â”€ exchange.service.ts
â”‚   â”‚   â”œâ”€â”€ exchange.module.ts
â”‚   â”‚   â”œâ”€â”€ matching.service.ts  # æ’®åˆå¼•æ“
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ notification/         # é€šçŸ¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ notification.gateway.ts
â”‚   â”‚   â”œâ”€â”€ notification.service.ts
â”‚   â”‚   â””â”€â”€ notification.module.ts
â”‚   â””â”€â”€ ranking/              # æ’è¡Œæ¦œæ¨¡å—
â””â”€â”€ database/                 # æ•°æ®åº“ç›¸å…³
    â”œâ”€â”€ migrations/          # è¿ç§»æ–‡ä»¶
    â””â”€â”€ seeds/               # ç§å­æ•°æ®
```

---

## å‰ç«¯å¼€å‘è®¡åˆ’

### 1. æ ¸å¿ƒç³»ç»Ÿå®ç°

#### 1.1 æ¸¸æˆç®¡ç†å™¨ (GameManager)

**åŠŸèƒ½èŒè´£**ï¼š
- å…¨å±€å•ä¾‹ï¼Œç®¡ç†æ¸¸æˆçŠ¶æ€
- ç©å®¶æ•°æ®çš„æœ¬åœ°ç¼“å­˜å’ŒåŒæ­¥
- åœºæ™¯åˆ‡æ¢å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†

**æ ¸å¿ƒä»£ç ç»“æ„**ï¼š
```typescript
// GameManager.ts
export class GameManager {
    private static _instance: GameManager;
    
    // ç©å®¶æ•°æ®
    private playerData: PlayerData;
    
    // æ¸¸æˆé…ç½®
    private gameConfig: GameConfig;
    
    // åˆå§‹åŒ–
    public async init(): Promise<void>
    
    // ç©å®¶æ•°æ®ç®¡ç†
    public getPlayerData(): PlayerData
    public updatePlayerData(data: Partial<PlayerData>): void
    public syncPlayerData(): Promise<void>
    
    // èµ„æºç®¡ç†
    public addResource(type: ResourceType, amount: number): void
    public consumeResource(type: ResourceType, amount: number): boolean
}
```

#### 1.2 ç½‘ç»œç®¡ç†å™¨ (NetworkManager)

**åŠŸèƒ½èŒè´£**ï¼š
- HTTPè¯·æ±‚å°è£…
- WebSocketè¿æ¥ç®¡ç†
- æ–­çº¿é‡è¿æœºåˆ¶
- è¯·æ±‚é˜Ÿåˆ—å’Œé‡è¯•

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
```typescript
// NetworkManager.ts
export class NetworkManager {
    // HTTPè¯·æ±‚
    public async request<T>(
        url: string, 
        method: string, 
        data?: any
    ): Promise<T>
    
    // WebSocketè¿æ¥
    public connectWebSocket(): void
    public on(event: string, callback: Function): void
    public emit(event: string, data: any): void
    
    // æ–­çº¿é‡è¿
    private reconnect(): void
}
```

#### 1.3 èµ„æºç®¡ç†å™¨

**åŠŸèƒ½èŒè´£**ï¼š
- é¢„åŠ è½½æ¸¸æˆèµ„æº
- åŠ¨æ€åŠ è½½å’Œé‡Šæ”¾
- èµ„æºç¼“å­˜ç®¡ç†

#### 1.4 éŸ³é¢‘ç®¡ç†å™¨

**åŠŸèƒ½èŒè´£**ï¼š
- èƒŒæ™¯éŸ³ä¹æ’­æ”¾
- éŸ³æ•ˆæ’­æ”¾
- éŸ³é‡æ§åˆ¶

### 2. ç•Œé¢æ¨¡å—å¼€å‘

#### 2.1 ä¸»ç•Œé¢ (MainScene)

**UIå¸ƒå±€ï¼ˆç§‘æŠ€é£å¡ç‰‡å¼ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ ğŸ’ çŸ¿çŸ³ 12,450  ğŸª™ BBå¸ 5,230â”‚     â”‚ â† é¡¶éƒ¨èµ„æºå¡ç‰‡ï¼ˆç´«è“æ¸å˜ï¼‰
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚  â›ï¸ æŒ–çŸ¿ä¸­...         â”‚        â”‚ â† æŒ–çŸ¿å¡ç‰‡ï¼ˆæ¸å˜åœ†è§’ï¼‰
â”‚    â”‚  çŸ¿è½¦: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 75%    â”‚        â”‚   è¿›åº¦æ¡ + å®æ—¶äº§å‡ºæ•°å­—
â”‚    â”‚  [æ”¶çŸ¿] æŒ‰é’®          â”‚        â”‚   æ‰å¹³ç§‘æŠ€æŒ‰é’®ï¼ˆéœ“è™¹æè¾¹ï¼‰
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ä»“åº“ â”‚æ å¤º â”‚äº¤æ˜“ â”‚æ’è¡Œ â”‚è®¾ç½® â”‚  â”‚ â† åº•éƒ¨ Tabï¼ˆæ‰å¹³å›¾æ ‡ï¼‰
â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `ResourceCard`ï¼šèµ„æºå¡ç‰‡ï¼ˆæ¸å˜èƒŒæ™¯ + æ•°å­—è¿‡æ¸¡åŠ¨ç”» + é«˜æ–¯æ¨¡ç³Šç»ç’ƒï¼‰
- `MiningCard`ï¼šæŒ–çŸ¿å¡ç‰‡ï¼ˆç¯å½¢è¿›åº¦/é€Ÿåº¦è¡¨ç›˜ + å®æ—¶æ•°å­—æ›´æ–°ï¼‰
- `ActionButton`ï¼šç§‘æŠ€æŒ‰é’®ï¼ˆéœ“è™¹æè¾¹ + å†…å‘å…‰ + ç‚¹å‡»æ¶Ÿæ¼ªï¼‰
- `TabBar`ï¼šåº•éƒ¨å¯¼èˆªï¼ˆæ‰å¹³å›¾æ ‡ + æ»‘åŠ¨æŒ‡ç¤ºå™¨ + æ¯›ç»ç’ƒåº•æ ï¼‰
- `MetricTicker`ï¼šå…³é”®æŒ‡æ ‡æ»šåŠ¨æ¡ï¼ˆæ”¶ç›Šã€æ—¶é€Ÿï¼‰

**å…³é”®åŠŸèƒ½**ï¼š
1. **æŒ–çŸ¿äº§å‡ºå±•ç¤º**
   - ç›‘å¬ WebSocket `mine.update` äº‹ä»¶
   - æ™®é€šäº§å‡ºï¼šæ•°å­—æ»šåŠ¨è¿‡æ¸¡ï¼ˆCountUp åŠ¨ç”»ï¼‰
   - æš´å‡»ï¼šå¡ç‰‡å‘å…‰ + æ•°å­—æ”¾å¤§è„‰å†²
   - åå¡Œï¼šè¿›åº¦æ¡å˜ç° + å€’è®¡æ—¶æ•°å­—

2. **æ”¶çŸ¿äº¤äº’**
   - ç‚¹å‡»ç§‘æŠ€æŒ‰é’®ï¼ˆéœ“è™¹è¾¹æ¡†é«˜äº®ï¼‰
   - åˆ¤æ–­æ˜¯å¦æœ‰å…å¹¿å‘Šç‰¹æƒ
   - æ— ç‰¹æƒï¼šæ’­æ”¾å¹¿å‘Šåæ”¶çŸ¿
   - æœ‰ç‰¹æƒï¼šç›´æ¥æ”¶çŸ¿

3. **è§†è§‰æ•ˆæœï¼ˆé«˜çº§ï¼‰**
   - ç´«è“å¾„å‘+çº¿æ€§å¤åˆæ¸å˜ï¼›ç²’åº¦å™ªå£°è´´å›¾å åŠ ï¼Œå¢å¼ºè´¨æ„Ÿ
   - æ¯›ç»ç’ƒï¼ˆé«˜æ–¯æ¨¡ç³Š+åŠé€æ˜é®ç½©ï¼‰ä¸å†…å¤–å‘å…‰æè¾¹ï¼ˆShader Materialï¼‰
   - æ•°å­—æ»šåŠ¨è®¡æ•°ï¼ˆTweenï¼‰+ åƒä½åˆ†éš” + å¼¹ç°§ç¼“åŠ¨
   - ç‚¹å‡»æ¶Ÿæ¼ªï¼ˆæè´¨é®ç½©æ‰©æ•£ï¼‰+ å¡ç‰‡æ‚¬æµ®ç£æ€§å¸é™„

#### 2.2 ä»“åº“ç•Œé¢ (WarehouseScene)

**UIå¸ƒå±€ï¼ˆç§‘æŠ€å¡ç‰‡åˆ—è¡¨ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ å…¨éƒ¨  â”‚ çŸ¿æœº  â”‚ çŸ¿è½¦  â”‚ è£…å¤‡  â”‚  â”‚ â† Tabï¼ˆéœ“è™¹ä¸‹åˆ’çº¿ï¼‰
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚ â”‚ â”‚ ğŸ”§ é’é“œçŸ¿æœº  Lv.5       â”‚    â”‚â”‚ â† å¡ç‰‡ï¼ˆæ¸å˜èƒŒæ™¯ï¼‰
â”‚ â”‚ â”‚ [è£…å¤‡] [å‡çº§]           â”‚    â”‚â”‚   æ‰å¹³æŒ‰é’®
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚ â”‚ â”‚ ğŸšœ æœ¨åˆ¶çŸ¿è½¦  Lv.8       â”‚    â”‚â”‚
â”‚ â”‚ â”‚ [è£…å¤‡] [å‡çº§]           â”‚    â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚             [è¿”å›] æŒ‰é’®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **é“å…·åˆ—è¡¨å±•ç¤º**
   - ä½¿ç”¨ ScrollView + Prefab å®ç°
   - å¡ç‰‡å¼å¸ƒå±€ï¼ˆæ¸å˜èƒŒæ™¯ + åœ†è§’é˜´å½±ï¼‰
   - ç‚¹å‡»é“å…·å¼¹å‡ºè¯¦æƒ…å¼¹çª—ï¼ˆåº•éƒ¨æŠ½å±‰åŠ¨ç”»ï¼‰

2. **é“å…·è¯¦æƒ…å¼¹çª—**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ é“å…·å›¾æ ‡ â”‚  é“å…·åç§°+10 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚
â”‚  å±æ€§: æŒ–çŸ¿æ•ˆç‡ +50%      â”‚
â”‚                          â”‚
â”‚  å‡çº§ææ–™:                â”‚
â”‚  - ç¢ç‰‡ x 50  (æ‹¥æœ‰: 30) â”‚
â”‚  - BBå¸ x 1000           â”‚
â”‚  æˆåŠŸç‡: 75%             â”‚
â”‚                          â”‚
â”‚  [å‡çº§] [åˆæˆ] [å–æ¶ˆ]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

3. **å‡çº§/åˆæˆæ•ˆæœ**
   - ç‚¹å‡»æŒ‰é’®â†’æ‰£é™¤ææ–™â†’æœåŠ¡å™¨è®¡ç®—ç»“æœ
   - æˆåŠŸï¼šå¡ç‰‡å‘å…‰è„‰å†² + ç­‰çº§æ•°å­—æ»šåŠ¨æå‡
   - å¤±è´¥ï¼šå¡ç‰‡éœ‡åŠ¨ + çº¢è‰²é—ªçƒæç¤º

#### 2.3 æ å¤ºç•Œé¢ (PlunderScene)

**UIå¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å¯æ å¤ºç©å®¶åˆ—è¡¨                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ â”Œâ”€â”€â” ç©å®¶A  Lv.12 ã€æ å¤ºã€‘      â”‚â”‚
â”‚ â”‚ â”‚å¤´â”‚ é¢„ä¼°: çŸ¿çŸ³ 500             â”‚â”‚
â”‚ â”‚ â””â”€â”€â”˜                            â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â” ç©å®¶B  Lv.15 ã€æ å¤ºã€‘      â”‚â”‚
â”‚ â”‚ â”‚å¤´â”‚ é¢„ä¼°: çŸ¿çŸ³ 800             â”‚â”‚
â”‚ â”‚ â””â”€â”€â”˜                            â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â” ç©å®¶C  Lv.10 ã€æ å¤ºã€‘      â”‚â”‚
â”‚ â”‚ â”‚å¤´â”‚ é¢„ä¼°: çŸ¿çŸ³ 300             â”‚â”‚
â”‚ â”‚ â””â”€â”€â”˜                            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  æˆ‘çš„æ å¤ºå™¨: Lv.5   å†·å´: 00:00    â”‚
â”‚             [è¿”å›] æŒ‰é’®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **æ å¤ºç›®æ ‡åˆ—è¡¨**
   - è·å–å¯æ å¤ºç©å®¶ï¼ˆç­‰çº§ç›¸è¿‘ï¼‰
   - æ˜¾ç¤ºé¢„ä¼°å¯æ å¤ºèµ„æº
   - æ å¤ºå†·å´æ—¶é—´ç®¡ç†

2. **æ å¤ºæˆ˜æ–—æµç¨‹**
   - ç‚¹å‡»æ å¤ºæŒ‰é’®
   - æ’­æ”¾ç®€å•æˆ˜æ–—åŠ¨ç”»ï¼ˆ3-5ç§’ï¼‰
   - æ˜¾ç¤ºç»“ç®—å¼¹çª—ï¼ˆè·å¾—èµ„æºã€å¤ä»‡æŒ‰é’®ï¼‰

3. **å¤ä»‡ç³»ç»Ÿ**
   - è¢«æ å¤ºåå¯å¤ä»‡ï¼ˆé™æ—¶ï¼‰
   - å¤ä»‡æˆåŠŸåŒå€å¥–åŠ±

#### 2.4 äº¤æ˜“æ‰€ç•Œé¢ (ExchangeScene)

**UIå¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ å¸‚åœº â”‚ æŒ‚å• â”‚ è®¢å• â”‚ è¡Œæƒ… â”‚      â”‚ â† Tabåˆ‡æ¢
â”‚ â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â”‚ ã€å¸‚åœºé¡µã€‘                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ é“å…·: [ä¸‹æ‹‰é€‰æ‹©æ¡†]              â”‚â”‚
â”‚ â”‚                                 â”‚â”‚
â”‚ â”‚ å–å•åˆ—è¡¨:                       â”‚â”‚
â”‚ â”‚ ä»·æ ¼: 1000  æ•°é‡: 5  [è´­ä¹°]    â”‚â”‚
â”‚ â”‚ ä»·æ ¼: 1050  æ•°é‡: 3  [è´­ä¹°]    â”‚â”‚
â”‚ â”‚                                 â”‚â”‚
â”‚ â”‚ ä¹°å•åˆ—è¡¨:                       â”‚â”‚
â”‚ â”‚ ä»·æ ¼: 950   æ•°é‡: 10 [å‡ºå”®]    â”‚â”‚
â”‚ â”‚ ä»·æ ¼: 900   æ•°é‡: 8  [å‡ºå”®]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ æˆ‘çš„èµ„äº§: BBå¸ 5,230                â”‚
â”‚ [æŒ‚ä¹°å•] [æŒ‚å–å•] [è¿”å›]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **å¸‚åœºæ•°æ®å±•ç¤º**
   - å®æ—¶ä¹°å–æŒ‚å•åˆ—è¡¨
   - æœ€æ–°æˆäº¤ä»·æ ¼
   - ä»·æ ¼èµ°åŠ¿å›¾ï¼ˆå¯é€‰ï¼‰

2. **æŒ‚å•äº¤æ˜“**
   - æŒ‚ä¹°å•ï¼šè¾“å…¥ä»·æ ¼å’Œæ•°é‡ï¼Œé”å®šBBå¸
   - æŒ‚å–å•ï¼šé€‰æ‹©é“å…·ï¼Œé”å®šåº“å­˜
   - æ’¤å•ï¼šè§£é”èµ„æº

3. **è®¢å•ç®¡ç†**
   - æŸ¥çœ‹æˆ‘çš„æŒ‚å•ï¼ˆè¿›è¡Œä¸­ï¼‰
   - æŸ¥çœ‹å†å²æˆäº¤

4. **ä»·æ ¼èµ°åŠ¿**
   - ä½¿ç”¨Canvasç»˜åˆ¶ç®€æ˜“æŠ˜çº¿å›¾
   - æ˜¾ç¤ºè¿‘7å¤©/24å°æ—¶ä»·æ ¼èµ°åŠ¿

### 3. é€šç”¨UIç»„ä»¶ï¼ˆç§‘æŠ€é£é«˜çº§æ•ˆæœï¼‰

#### 3.1 å¼¹çª—ç»„ä»¶ (Dialog)
- ç¡®è®¤å¼¹çª—ï¼ˆæ¸å˜å¡ç‰‡ + æ¨¡ç³ŠèƒŒæ™¯ï¼‰
- æç¤ºå¼¹çª—ï¼ˆé¡¶éƒ¨æ»‘å…¥ Toastï¼‰
- è¾“å…¥å¼¹çª—ï¼ˆéœ“è™¹æè¾¹è¾“å…¥æ¡†ï¼‰

#### 3.2 æ•°å­—ç»„ä»¶ (CountUpText)
- èµ„æºå¢åŠ æ»šåŠ¨è®¡æ•°
- å¤§æ•°å­—æ ¼å¼åŒ–ï¼ˆ12,450ï¼‰

#### 3.3 ç»ç’ƒå¡ç‰‡ (GlassCard)
- æ¯›ç»ç’ƒæè´¨ï¼ˆèƒŒæ™¯é‡‡æ · + æ¨¡ç³Š + å™ªå£°ï¼‰
- å†…å¤–å‘å…‰æè¾¹ï¼ˆå¯è°ƒè‰²/å¼ºåº¦/åŠå¾„ï¼‰

#### 3.4 åŠ è½½ç»„ä»¶ (Loading)
- å…¨å±åŠ è½½ï¼ˆåœ†ç¯è¿›åº¦ + æ¸å˜æ—‹è½¬ï¼‰
- æŒ‰é’®åŠ è½½çŠ¶æ€ï¼ˆéœ“è™¹è¾¹æ¡†è„‰å†²ï¼‰

#### 3.5 Toastç»„ä»¶
- è½»æç¤ºæ¶ˆæ¯ï¼ˆåŠé€æ˜å¡ç‰‡ + æ·¡å…¥æ·¡å‡ºï¼‰

#### 3.6 è¿›åº¦æ¡ç»„ä»¶ (ProgressBar)
- æ¸å˜å¡«å……è¿›åº¦æ¡
- åœ†ç¯è¿›åº¦ï¼ˆæŒ–çŸ¿çŠ¶æ€ï¼‰

#### 3.7 å›¾è¡¨ç»„ä»¶ (Charts)
- äº§å‡ºæŠ˜çº¿å›¾ï¼ˆBezier å¹³æ»‘ + æ¸å˜å¡«å……ï¼‰
- ä»“ä½å æ¯”ç¯å›¾ï¼ˆç©ºå¿ƒç¯ + ä¸­å¿ƒæ•°å­—ï¼‰

### 4. æ•°æ®ç®¡ç†

#### 4.1 æœ¬åœ°å­˜å‚¨
```typescript
// LocalStorage.ts
export class LocalStorage {
    // ä¿å­˜ç©å®¶Token
    public static saveToken(token: string): void
    
    // ä¿å­˜æ¸¸æˆè®¾ç½®
    public static saveSettings(settings: GameSettings): void
    
    // ä¿å­˜ç¼“å­˜æ•°æ®
    public static saveCache(key: string, data: any): void
}
```

#### 4.2 æ•°æ®åŒæ­¥ç­–ç•¥
- å…³é”®æ•°æ®ï¼ˆèµ„æºã€é“å…·ï¼‰ï¼šæ¯æ¬¡æ“ä½œåç«‹å³åŒæ­¥
- éå…³é”®æ•°æ®ï¼ˆè®¾ç½®ï¼‰ï¼šå»¶è¿ŸåŒæ­¥
- æ–­çº¿é‡è¿åï¼šå…¨é‡åŒæ­¥ç©å®¶æ•°æ®

---

## åç«¯å¼€å‘è®¡åˆ’

> é»˜è®¤è¿è¡Œæ¨¡å¼ï¼ˆæœ¬åœ°å•æœºï¼‰ï¼šä»…ä¾èµ– JWT + WebSocket + å†…å­˜å­˜å‚¨å³å¯è·‘é€šå®Œæ•´å‰ç«¯æµç¨‹ã€‚PostgreSQL / Redis / Bull / TypeORM ç­‰å‡ä¸ºâ€œå¯é€‰æ‰©å±•â€ï¼ŒæŒ‰éœ€å¼€å¯ã€‚æ–‡æ¡£å†…æ‰€æœ‰æ•°æ®åº“/éƒ¨ç½²ç›¸å…³ç« èŠ‚å‡è§†ä¸ºå¯é€‰ï¼Œä¸å½±å“æœ¬åœ°åŠŸèƒ½éªŒè¯ã€‚

### 1. åŸºç¡€è®¾æ–½æ­å»º

#### 1.1 é¡¹ç›®åˆå§‹åŒ–

æœ¬åœ°æœ€å°ä¾èµ–ï¼ˆå†…å­˜æ¨¡å¼å³å¯è¿è¡Œï¼‰ï¼š
```bash
# åˆ›å»ºé¡¹ç›®
npm i -g @nestjs/cli
nest new mining-game-backend

# å¿…éœ€ä¾èµ–ï¼ˆæœ¬åœ°å•æœºï¼‰
npm install --save @nestjs/jwt @nestjs/passport passport passport-jwt
npm install --save @nestjs/websockets @nestjs/platform-socket.io
npm install --save class-validator class-transformer
```

å¯é€‰æ‰©å±•ä¾èµ–ï¼ˆéœ€è¦æ•°æ®åº“/æ¶ˆæ¯é˜Ÿåˆ—æ—¶å†å®‰è£…ï¼‰ï¼š
```bash
npm install --save @nestjs/typeorm typeorm pg
npm install --save redis ioredis
npm install --save @nestjs/bull bull
```

#### 1.2 é…ç½®ç®¡ç†ï¼ˆå¯é€‰ï¼Œå½“å¯ç”¨æ•°æ®åº“/Redisæ—¶ï¼‰

```typescript
// config/database.config.ts
export default registerAs('database', () => ({
  type: 'postgres',
  host: process.env.DB_HOST || 'localhost',
  port: parseInt(process.env.DB_PORT) || 5432,
  username: process.env.DB_USERNAME || 'postgres',
  password: process.env.DB_PASSWORD || 'password',
  database: process.env.DB_NAME || 'mining_game',
  entities: ['dist/**/*.entity{.ts,.js}'],
  synchronize: process.env.NODE_ENV === 'development',
  logging: process.env.NODE_ENV === 'development',
}));

// config/redis.config.ts
export default registerAs('redis', () => ({
  host: process.env.REDIS_HOST || 'localhost',
  port: parseInt(process.env.REDIS_PORT) || 6379,
  password: process.env.REDIS_PASSWORD || '',
  db: parseInt(process.env.REDIS_DB) || 0,
}));
```

### 2. æ¨¡å—å¼€å‘è¯¦è§£ï¼ˆæœ¬åœ°æœ€å°å¯ç”¨ + å¯é€‰æ‰©å±•ï¼‰

#### 2.1 è®¤è¯æˆæƒæ¨¡å— (Auth Module)

**åŠŸèƒ½æ¸…å•ï¼ˆæœ¬åœ°æœ€å°ï¼‰**ï¼š
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•ï¼ˆJWTï¼‰
- Token æ ¡éªŒä¸å—ä¿æŠ¤æ¥å£

**å¯é€‰æ‰©å±•**ï¼š
- å¾®ä¿¡H5æˆæƒç™»å½•
- Token åˆ·æ–°æœºåˆ¶

**æ ¸å¿ƒä»£ç **ï¼š

```typescript
// auth/auth.service.ts
@Injectable()
export class AuthService {
  constructor(
    private userService: UserService,
    private jwtService: JwtService,
  ) {}

  // ç”¨æˆ·ç™»å½•
  async login(loginDto: LoginDto): Promise<LoginResponse> {
    const user = await this.userService.validateUser(
      loginDto.username,
      loginDto.password,
    );
    
    if (!user) {
      throw new UnauthorizedException('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
    }
    
    const payload = { sub: user.id, username: user.username };
    return {
      access_token: this.jwtService.sign(payload),
      user: user,
    };
  }

  // å¾®ä¿¡ç™»å½•
  async wechatLogin(code: string): Promise<LoginResponse> {
    // 1. é€šè¿‡codeè·å–å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯
    const wechatUserInfo = await this.getWechatUserInfo(code);
    
    // 2. æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
    let user = await this.userService.findByWechatOpenId(
      wechatUserInfo.openid,
    );
    
    if (!user) {
      user = await this.userService.createFromWechat(wechatUserInfo);
    }
    
    // 3. ç”ŸæˆToken
    const payload = { sub: user.id, username: user.username };
    return {
      access_token: this.jwtService.sign(payload),
      user: user,
    };
  }
}

// auth/auth.controller.ts
@Controller('api/auth')
export class AuthController {
  constructor(private authService: AuthService) {}

  @Post('login')
  async login(@Body() loginDto: LoginDto) {
    return this.authService.login(loginDto);
  }

  @Post('wechat-login')
  async wechatLogin(@Body('code') code: string) {
    return this.authService.wechatLogin(code);
  }

  @UseGuards(JwtAuthGuard)
  @Get('profile')
  getProfile(@Request() req) {
    return req.user;
  }
}
```

#### 2.2 ç”¨æˆ·æ¨¡å— (User Module)

**æ•°æ®æ¨¡å‹**ï¼š

```typescript
// user/entities/user.entity.ts
@Entity('users')
export class User {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column({ unique: true })
  username: string;

  @Column({ select: false })
  password: string;

  @Column({ nullable: true })
  wechat_openid: string;

  @Column({ default: '' })
  nickname: string;

  @Column({ default: '' })
  avatar: string;

  @Column({ type: 'int', default: 1 })
  level: number;

  @Column({ type: 'bigint', default: 0 })
  ore_amount: number;

  @Column({ type: 'bigint', default: 0 })
  bb_coins: number;

  @Column({ type: 'bigint', default: 0 })
  experience: number;

  @Column({ type: 'boolean', default: false })
  is_vip: boolean;

  @Column({ type: 'timestamp', nullable: true })
  vip_expire_at: Date;

  @CreateDateColumn()
  created_at: Date;

  @UpdateDateColumn()
  updated_at: Date;
}
```

**æœåŠ¡å®ç°**ï¼š

```typescript
// user/user.service.ts
@Injectable()
export class UserService {
  constructor(
    @InjectRepository(User)
    private userRepository: Repository<User>,
    private redisService: RedisService,
  ) {}

  // è·å–ç”¨æˆ·ä¿¡æ¯
  async findById(id: string): Promise<User> {
    // å…ˆä»ç¼“å­˜è¯»å–
    const cached = await this.redisService.get(`user:${id}`);
    if (cached) {
      return JSON.parse(cached);
    }
    
    // ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è¯»å–
    const user = await this.userRepository.findOne({ where: { id } });
    
    // å†™å…¥ç¼“å­˜ï¼ˆ30åˆ†é’Ÿè¿‡æœŸï¼‰
    await this.redisService.setex(
      `user:${id}`,
      1800,
      JSON.stringify(user),
    );
    
    return user;
  }

  // å¢åŠ èµ„æº
  async addResource(
    userId: string,
    resourceType: 'ore' | 'coin',
    amount: number,
  ): Promise<void> {
    const field = resourceType === 'ore' ? 'ore_amount' : 'bb_coins';
    
    await this.userRepository.increment(
      { id: userId },
      field,
      amount,
    );
    
    // æ¸…é™¤ç¼“å­˜
    await this.redisService.del(`user:${userId}`);
  }

  // æ‰£é™¤èµ„æºï¼ˆåŸå­æ“ä½œï¼‰
  async consumeResource(
    userId: string,
    resourceType: 'ore' | 'coin',
    amount: number,
  ): Promise<boolean> {
    const field = resourceType === 'ore' ? 'ore_amount' : 'bb_coins';
    
    const result = await this.userRepository
      .createQueryBuilder()
      .update(User)
      .set({ [field]: () => `${field} - ${amount}` })
      .where('id = :userId', { userId })
      .andWhere(`${field} >= :amount`, { amount })
      .execute();
    
    if (result.affected > 0) {
      await this.redisService.del(`user:${userId}`);
      return true;
    }
    
    return false;
  }
}
```

#### 2.3 æŒ–çŸ¿æ¨¡å— (Mine Module)

**æ ¸å¿ƒé€»è¾‘**ï¼š

```typescript
// gameplay/mine/mine.service.ts
@Injectable()
export class MineService {
  constructor(
    private userService: UserService,
    private itemService: ItemService,
    private notificationService: NotificationService,
    @InjectQueue('mine') private mineQueue: Queue,
  ) {}

  // å¼€å§‹æŒ–çŸ¿
  async startMining(userId: string): Promise<void> {
    // è·å–ç©å®¶çŸ¿æœºç­‰çº§
    const miner = await this.itemService.getUserEquippedItem(
      userId,
      'miner',
    );
    
    // è®¡ç®—äº§å‡ºé—´éš”ï¼ˆåŸºç¡€60ç§’ï¼ŒçŸ¿æœºæ¯çº§-2ç§’ï¼‰
    const baseInterval = 60;
    const minerLevel = miner?.level || 1;
    const interval = Math.max(10, baseInterval - minerLevel * 2);
    
    // æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—
    await this.mineQueue.add(
      'produce',
      { userId },
      {
        repeat: { every: interval * 1000 },
        jobId: `mine:${userId}`,
      },
    );
  }

  // å¤„ç†æŒ–çŸ¿äº§å‡ºï¼ˆç”±Queue Workerè°ƒç”¨ï¼‰
  @Process('produce')
  async handleMineProduce(job: Job<{ userId: string }>): Promise<void> {
    const { userId } = job.data;
    
    // æ£€æŸ¥çŸ¿æ´æ˜¯å¦åå¡Œä¸­
    const isCollapsed = await this.isMineColla(userId);
    if (isCollapsed) {
      return;
    }
    
    // è·å–ç©å®¶çŸ¿æœºç­‰çº§
    const miner = await this.itemService.getUserEquippedItem(
      userId,
      'miner',
    );
    const minerLevel = miner?.level || 1;
    
    // è®¡ç®—åŸºç¡€äº§å‡ºï¼ˆçŸ¿æœºæ¯çº§+10ï¼‰
    const baseOutput = 10 + minerLevel * 10;
    
    // éšæœºäº‹ä»¶åˆ¤å®š
    const random = Math.random();
    let produceType: 'normal' | 'critical' | 'collapse';
    let finalOutput: number;
    
    if (random < 0.05) {
      // 5% åå¡Œ
      produceType = 'collapse';
      finalOutput = 0;
      
      // è®¾ç½®åå¡ŒçŠ¶æ€ï¼ˆ2åˆ†é’Ÿï¼‰
      await this.setMineCollapse(userId, 120);
    } else if (random < 0.30) {
      // 25% æš´å‡»ï¼ˆ3å€äº§å‡ºï¼‰
      produceType = 'critical';
      finalOutput = baseOutput * 3;
    } else {
      // 70% æ™®é€šäº§å‡º
      produceType = 'normal';
      finalOutput = baseOutput;
    }
    
    // æ£€æŸ¥çŸ¿è½¦å®¹é‡
    const cart = await this.itemService.getUserEquippedItem(
      userId,
      'cart',
    );
    const cartCapacity = (cart?.level || 1) * 1000;
    
    let currentAmount = await this.getCurrentCartAmount(userId);
    
    if (currentAmount + finalOutput > cartCapacity) {
      finalOutput = cartCapacity - currentAmount;
    }
    
    // æ›´æ–°çŸ¿è½¦å­˜å‚¨
    await this.addToCart(userId, finalOutput);
    
    // é€šè¿‡WebSocketæ¨é€ç»™å®¢æˆ·ç«¯
    this.notificationService.emitToUser(userId, 'mine.update', {
      type: produceType,
      amount: finalOutput,
      cartAmount: currentAmount + finalOutput,
      cartCapacity: cartCapacity,
    });
    
    // åå¡Œé€šçŸ¥
    if (produceType === 'collapse') {
      this.notificationService.emitToUser(userId, 'mine.collapse', {
        repair_duration: 120,
      });
    }
  }

  // æ”¶çŸ¿
  async collectOre(userId: string, watchedAd: boolean): Promise<number> {
    // æ£€æŸ¥æ˜¯å¦éœ€è¦è§‚çœ‹å¹¿å‘Š
    const isVip = await this.userService.isVip(userId);
    if (!isVip && !watchedAd) {
      throw new BadRequestException('è¯·å…ˆè§‚çœ‹å¹¿å‘Š');
    }
    
    // è·å–çŸ¿è½¦å½“å‰å­˜å‚¨
    const cartAmount = await this.getCurrentCartAmount(userId);
    
    if (cartAmount === 0) {
      throw new BadRequestException('çŸ¿è½¦ä¸ºç©º');
    }
    
    // è½¬å…¥ç©å®¶ä»“åº“
    await this.userService.addResource(userId, 'ore', cartAmount);
    
    // æ¸…ç©ºçŸ¿è½¦
    await this.clearCart(userId);
    
    return cartAmount;
  }

  // è¾…åŠ©æ–¹æ³•
  private async getCurrentCartAmount(userId: string): Promise<number> {
    const amount = await this.redisService.get(`cart:${userId}`);
    return parseInt(amount) || 0;
  }

  private async addToCart(userId: string, amount: number): Promise<void> {
    await this.redisService.incrby(`cart:${userId}`, amount);
  }

  private async clearCart(userId: string): Promise<void> {
    await this.redisService.del(`cart:${userId}`);
  }

  private async setMineCollapse(
    userId: string,
    seconds: number,
  ): Promise<void> {
    await this.redisService.setex(`collapse:${userId}`, seconds, '1');
  }

  private async isMineCollapsed(userId: string): Promise<boolean> {
    const collapsed = await this.redisService.get(`collapse:${userId}`);
    return collapsed === '1';
  }
}
```

#### 2.4 é“å…·æ¨¡å— (Item Module)

**æ•°æ®æ¨¡å‹**ï¼š

```typescript
// gameplay/item/entities/item-template.entity.ts
@Entity('item_templates')
export class ItemTemplate {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  name: string;

  @Column({ type: 'enum', enum: ['miner', 'cart', 'raider', 'shield'] })
  category: string;

  @Column({ type: 'text' })
  description: string;

  @Column({ type: 'int' })
  max_level: number;

  @Column({ type: 'json' })
  upgrade_formula: any; // å‡çº§å…¬å¼é…ç½®
}

// gameplay/item/entities/user-item.entity.ts
@Entity('user_items')
export class UserItem {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @ManyToOne(() => User)
  @JoinColumn({ name: 'user_id' })
  user: User;

  @Column()
  user_id: string;

  @ManyToOne(() => ItemTemplate)
  @JoinColumn({ name: 'template_id' })
  template: ItemTemplate;

  @Column()
  template_id: string;

  @Column({ type: 'int', default: 1 })
  level: number;

  @Column({ type: 'boolean', default: false })
  is_equipped: boolean;

  @CreateDateColumn()
  created_at: Date;

  @UpdateDateColumn()
  updated_at: Date;
}
```

**åˆæˆ/å‡çº§é€»è¾‘**ï¼š

```typescript
// gameplay/item/item.service.ts
@Injectable()
export class ItemService {
  constructor(
    @InjectRepository(UserItem)
    private userItemRepository: Repository<UserItem>,
    @InjectRepository(ItemTemplate)
    private itemTemplateRepository: Repository<ItemTemplate>,
    private userService: UserService,
  ) {}

  // é“å…·å‡çº§
  async upgradeItem(
    userId: string,
    itemId: string,
  ): Promise<{ success: boolean; newLevel?: number }> {
    const item = await this.userItemRepository.findOne({
      where: { id: itemId, user_id: userId },
      relations: ['template'],
    });

    if (!item) {
      throw new NotFoundException('é“å…·ä¸å­˜åœ¨');
    }

    if (item.level >= item.template.max_level) {
      throw new BadRequestException('å·²è¾¾æœ€é«˜ç­‰çº§');
    }

    // è·å–å‡çº§é…ç½®
    const upgradeConfig = item.template.upgrade_formula[item.level];
    
    // æ£€æŸ¥å¹¶æ‰£é™¤ææ–™
    const hasEnoughMaterials = await this.checkAndConsumeMaterials(
      userId,
      upgradeConfig.materials,
    );
    
    if (!hasEnoughMaterials) {
      throw new BadRequestException('ææ–™ä¸è¶³');
    }

    // æ ¹æ®æˆåŠŸç‡åˆ¤å®š
    const successRate = this.calculateSuccessRate(item.level);
    const random = Math.random();
    
    if (random < successRate) {
      // å‡çº§æˆåŠŸ
      item.level += 1;
      await this.userItemRepository.save(item);
      
      // é«˜ç­‰çº§é“å…·å‡çº§æˆåŠŸï¼Œå…¨æœå¹¿æ’­
      if (item.level >= 10) {
        // é€šè¿‡WebSocketå¹¿æ’­
        this.notificationService.broadcastToAll('item.upgrade_success', {
          player: await this.userService.getNickname(userId),
          item: `${item.template.name} +${item.level}`,
        });
      }
      
      return { success: true, newLevel: item.level };
    } else {
      // å‡çº§å¤±è´¥ï¼Œææ–™å·²æ‰£é™¤
      return { success: false };
    }
  }

  // è®¡ç®—æˆåŠŸç‡ï¼ˆAIç²¾ç®—åºåˆ—ï¼‰
  private calculateSuccessRate(currentLevel: number): number {
    // ç­‰çº§è¶Šé«˜ï¼ŒæˆåŠŸç‡è¶Šä½
    const baseRate = 0.8;
    const decreasePerLevel = 0.05;
    return Math.max(0.1, baseRate - currentLevel * decreasePerLevel);
  }

  // ç¢ç‰‡åˆæˆé“å…·
  async composeItem(
    userId: string,
    templateId: string,
  ): Promise<UserItem> {
    const template = await this.itemTemplateRepository.findOne({
      where: { id: templateId },
    });

    if (!template) {
      throw new NotFoundException('é“å…·æ¨¡æ¿ä¸å­˜åœ¨');
    }

    // æ£€æŸ¥ç¢ç‰‡æ•°é‡ï¼ˆå‡è®¾éœ€è¦50ä¸ªç¢ç‰‡ï¼‰
    const hasEnoughFragments = await this.consumeFragments(
      userId,
      templateId,
      50,
    );
    
    if (!hasEnoughFragments) {
      throw new BadRequestException('ç¢ç‰‡ä¸è¶³');
    }

    // åˆ›å»ºæ–°é“å…·
    const newItem = this.userItemRepository.create({
      user_id: userId,
      template_id: templateId,
      level: 1,
      is_equipped: false,
    });

    return this.userItemRepository.save(newItem);
  }
}
```

#### 2.5 æ å¤ºæ¨¡å— (Plunder Module)

**æ ¸å¿ƒé€»è¾‘**ï¼š

```typescript
// gameplay/plunder/plunder.service.ts
@Injectable()
export class PlunderService {
  constructor(
    private userService: UserService,
    private itemService: ItemService,
  ) {}

  // è·å–å¯æ å¤ºç©å®¶åˆ—è¡¨
  async getPlunderTargets(
    userId: string,
  ): Promise<PlunderTarget[]> {
    const user = await this.userService.findById(userId);
    
    // æŸ¥è¯¢ç­‰çº§ç›¸è¿‘çš„ç©å®¶ï¼ˆÂ±5çº§ï¼‰
    const targets = await this.userRepository
      .createQueryBuilder('user')
      .where('user.id != :userId', { userId })
      .andWhere('user.level BETWEEN :minLevel AND :maxLevel', {
        minLevel: user.level - 5,
        maxLevel: user.level + 5,
      })
      .andWhere('user.ore_amount > :minOre', { minOre: 100 })
      .orderBy('RANDOM()')
      .limit(20)
      .getMany();
    
    // è®¡ç®—é¢„ä¼°å¯æ å¤ºèµ„æº
    return targets.map(target => ({
      id: target.id,
      nickname: target.nickname,
      avatar: target.avatar,
      level: target.level,
      estimated_loot: Math.floor(target.ore_amount * 0.1),
    }));
  }

  // æ‰§è¡Œæ å¤º
  async executePlunder(
    attackerId: string,
    defenderId: string,
  ): Promise<PlunderResult> {
    // æ£€æŸ¥æ å¤ºå™¨å†·å´
    const canPlunder = await this.checkPlunderCooldown(attackerId);
    if (!canPlunder) {
      throw new BadRequestException('æ å¤ºå™¨å†·å´ä¸­');
    }
    
    // è·å–åŒæ–¹è£…å¤‡
    const attackerRaider = await this.itemService.getUserEquippedItem(
      attackerId,
      'raider',
    );
    const defenderShield = await this.itemService.getUserEquippedItem(
      defenderId,
      'shield',
    );
    
    const attacker = await this.userService.findById(attackerId);
    const defender = await this.userService.findById(defenderId);
    
    // è®¡ç®—æ å¤ºç‡
    const raiderLevel = attackerRaider?.level || 1;
    const shieldLevel = defenderShield?.level || 1;
    
    // åŸºç¡€æ å¤ºç‡10%ï¼Œæ å¤ºå™¨æ¯çº§+1%ï¼Œé˜²å¾¡ç›¾æ¯çº§-0.5%
    let plunderRate = 0.1 + raiderLevel * 0.01 - shieldLevel * 0.005;
    plunderRate = Math.max(0.05, Math.min(0.3, plunderRate)); // é™åˆ¶åœ¨5%-30%
    
    // è®¡ç®—æ å¤ºæ•°é‡
    const lootAmount = Math.floor(defender.ore_amount * plunderRate);
    
    if (lootAmount === 0) {
      throw new BadRequestException('å¯¹æ–¹èµ„æºä¸è¶³');
    }
    
    // æ‰§è¡Œèµ„æºè½¬ç§»
    await this.userService.consumeResource(defenderId, 'ore', lootAmount);
    await this.userService.addResource(attackerId, 'ore', lootAmount);
    
    // è®°å½•æ å¤ºæ—¥å¿—
    await this.logPlunder(attackerId, defenderId, lootAmount);
    
    // è®¾ç½®æ å¤ºå™¨å†·å´ï¼ˆ1å°æ—¶ï¼‰
    await this.setPlunderCooldown(attackerId, 3600);
    
    // é€šçŸ¥è¢«æ å¤ºè€…
    this.notificationService.emitToUser(defenderId, 'plunder.attacked', {
      attacker: attacker.nickname,
      loss: lootAmount,
    });
    
    return {
      success: true,
      loot_amount: lootAmount,
      can_revenge: true,
      revenge_expire: Date.now() + 24 * 3600 * 1000, // 24å°æ—¶å†…å¯å¤ä»‡
    };
  }
}
```

#### 2.6 äº¤æ˜“æ‰€æ¨¡å— (Exchange Module)

**æ•°æ®æ¨¡å‹**ï¼š

```typescript
// exchange/entities/exchange-order.entity.ts
@Entity('exchange_orders')
export class ExchangeOrder {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @ManyToOne(() => User)
  @JoinColumn({ name: 'user_id' })
  user: User;

  @Column()
  user_id: string;

  @ManyToOne(() => ItemTemplate)
  @JoinColumn({ name: 'item_template_id' })
  item_template: ItemTemplate;

  @Column()
  item_template_id: string;

  @Column({ type: 'enum', enum: ['buy', 'sell'] })
  type: string;

  @Column({ type: 'int' })
  price: number;

  @Column({ type: 'int' })
  amount: number;

  @Column({ type: 'int', default: 0 })
  filled_amount: number;

  @Column({
    type: 'enum',
    enum: ['pending', 'partial', 'filled', 'cancelled'],
    default: 'pending',
  })
  status: string;

  @CreateDateColumn()
  created_at: Date;

  @UpdateDateColumn()
  updated_at: Date;
}
```

**æ’®åˆå¼•æ“**ï¼š

```typescript
// exchange/matching.service.ts
@Injectable()
export class MatchingService {
  constructor(
    @InjectRepository(ExchangeOrder)
    private orderRepository: Repository<ExchangeOrder>,
    private userService: UserService,
    private itemService: ItemService,
  ) {}

  // æŒ‚ä¹°å•
  async placeBuyOrder(
    userId: string,
    itemTemplateId: string,
    price: number,
    amount: number,
  ): Promise<ExchangeOrder> {
    // è®¡ç®—æ€»ä»·
    const totalCost = price * amount;
    
    // æ‰£é™¤BBå¸
    const success = await this.userService.consumeResource(
      userId,
      'coin',
      totalCost,
    );
    
    if (!success) {
      throw new BadRequestException('BBå¸ä¸è¶³');
    }
    
    // åˆ›å»ºä¹°å•
    const order = this.orderRepository.create({
      user_id: userId,
      item_template_id: itemTemplateId,
      type: 'buy',
      price,
      amount,
      status: 'pending',
    });
    
    await this.orderRepository.save(order);
    
    // å°è¯•ç«‹å³æ’®åˆ
    await this.tryMatch(order);
    
    return order;
  }

  // æŒ‚å–å•
  async placeSellOrder(
    userId: string,
    itemInstanceId: string,
    price: number,
  ): Promise<ExchangeOrder> {
    // è·å–é“å…·
    const item = await this.itemService.findUserItem(userId, itemInstanceId);
    
    if (!item) {
      throw new NotFoundException('é“å…·ä¸å­˜åœ¨');
    }
    
    if (item.is_equipped) {
      throw new BadRequestException('å·²è£…å¤‡çš„é“å…·æ— æ³•å‡ºå”®');
    }
    
    // é”å®šé“å…·ï¼ˆæ ‡è®°ä¸ºäº¤æ˜“ä¸­ï¼‰
    await this.itemService.lockItem(itemInstanceId);
    
    // åˆ›å»ºå–å•
    const order = this.orderRepository.create({
      user_id: userId,
      item_template_id: item.template_id,
      type: 'sell',
      price,
      amount: 1,
      status: 'pending',
    });
    
    await this.orderRepository.save(order);
    
    // å°è¯•ç«‹å³æ’®åˆ
    await this.tryMatch(order);
    
    return order;
  }

  // æ’®åˆå¼•æ“
  private async tryMatch(order: ExchangeOrder): Promise<void> {
    if (order.type === 'buy') {
      // ä¹°å•ï¼ŒåŒ¹é…ä»·æ ¼<=ä¹°ä»·çš„å–å•
      const sellOrders = await this.orderRepository.find({
        where: {
          item_template_id: order.item_template_id,
          type: 'sell',
          status: In(['pending', 'partial']),
          price: LessThanOrEqual(order.price),
        },
        order: { price: 'ASC', created_at: 'ASC' },
      });
      
      for (const sellOrder of sellOrders) {
        if (order.filled_amount >= order.amount) {
          break;
        }
        
        await this.executeTrade(order, sellOrder);
      }
    } else {
      // å–å•ï¼ŒåŒ¹é…ä»·æ ¼>=å–ä»·çš„ä¹°å•
      const buyOrders = await this.orderRepository.find({
        where: {
          item_template_id: order.item_template_id,
          type: 'buy',
          status: In(['pending', 'partial']),
          price: MoreThanOrEqual(order.price),
        },
        order: { price: 'DESC', created_at: 'ASC' },
      });
      
      for (const buyOrder of buyOrders) {
        if (order.filled_amount >= order.amount) {
          break;
        }
        
        await this.executeTrade(buyOrder, order);
      }
    }
  }

  // æ‰§è¡Œäº¤æ˜“
  private async executeTrade(
    buyOrder: ExchangeOrder,
    sellOrder: ExchangeOrder,
  ): Promise<void> {
    // è®¡ç®—æœ¬æ¬¡æˆäº¤æ•°é‡
    const buyRemaining = buyOrder.amount - buyOrder.filled_amount;
    const sellRemaining = sellOrder.amount - sellOrder.filled_amount;
    const tradeAmount = Math.min(buyRemaining, sellRemaining);
    
    // ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§
    await this.orderRepository.manager.transaction(async manager => {
      // æ›´æ–°è®¢å•çŠ¶æ€
      buyOrder.filled_amount += tradeAmount;
      sellOrder.filled_amount += tradeAmount;
      
      if (buyOrder.filled_amount >= buyOrder.amount) {
        buyOrder.status = 'filled';
      } else {
        buyOrder.status = 'partial';
      }
      
      if (sellOrder.filled_amount >= sellOrder.amount) {
        sellOrder.status = 'filled';
      } else {
        sellOrder.status = 'partial';
      }
      
      await manager.save([buyOrder, sellOrder]);
      
      // è½¬ç§»é“å…·ï¼ˆä»å–å®¶åˆ°ä¹°å®¶ï¼‰
      await this.itemService.transferItem(
        sellOrder.user_id,
        buyOrder.user_id,
        sellOrder.item_template_id,
        tradeAmount,
      );
      
      // è½¬ç§»BBå¸ï¼ˆä»ç³»ç»Ÿé”å®šè´¦æˆ·åˆ°å–å®¶ï¼‰
      const tradeCost = sellOrder.price * tradeAmount;
      await this.userService.addResource(
        sellOrder.user_id,
        'coin',
        tradeCost,
      );
      
      // è®°å½•æˆäº¤å†å²
      await this.logTrade(buyOrder, sellOrder, tradeAmount, sellOrder.price);
    });
    
    // é€šçŸ¥åŒæ–¹
    this.notificationService.emitToUser(buyOrder.user_id, 'exchange.deal', {
      type: 'buy',
      item: sellOrder.item_template.name,
      amount: tradeAmount,
      price: sellOrder.price,
    });
    
    this.notificationService.emitToUser(sellOrder.user_id, 'exchange.deal', {
      type: 'sell',
      item: sellOrder.item_template.name,
      amount: tradeAmount,
      price: sellOrder.price,
    });
  }
}
```

#### 2.7 é€šçŸ¥æ¨¡å— (Notification Module)

**WebSocket Gateway**ï¼š

```typescript
// notification/notification.gateway.ts
@WebSocketGateway({
  cors: { origin: '*' },
  namespace: '/game',
})
export class NotificationGateway implements OnGatewayConnection, OnGatewayDisconnect {
  @WebSocketServer()
  server: Server;
  
  private userSocketMap: Map<string, string> = new Map(); // userId -> socketId

  constructor(private jwtService: JwtService) {}

  // å®¢æˆ·ç«¯è¿æ¥
  async handleConnection(client: Socket) {
    try {
      // éªŒè¯Token
      const token = client.handshake.auth.token;
      const payload = this.jwtService.verify(token);
      const userId = payload.sub;
      
      // è®°å½•ç”¨æˆ·Socketæ˜ å°„
      this.userSocketMap.set(userId, client.id);
      client.data.userId = userId;
      
      console.log(`User ${userId} connected`);
    } catch (error) {
      client.disconnect();
    }
  }

  // å®¢æˆ·ç«¯æ–­å¼€
  handleDisconnect(client: Socket) {
    const userId = client.data.userId;
    if (userId) {
      this.userSocketMap.delete(userId);
      console.log(`User ${userId} disconnected`);
    }
  }

  // å‘æŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯
  emitToUser(userId: string, event: string, data: any): void {
    const socketId = this.userSocketMap.get(userId);
    if (socketId) {
      this.server.to(socketId).emit(event, data);
    }
  }

  // å…¨æœå¹¿æ’­
  broadcastToAll(event: string, data: any): void {
    this.server.emit(event, data);
  }
}
```

---

## æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

#### 1. ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    wechat_openid VARCHAR(100) UNIQUE,
    nickname VARCHAR(50) DEFAULT '',
    avatar VARCHAR(255) DEFAULT '',
    level INT DEFAULT 1,
    ore_amount BIGINT DEFAULT 0,
    bb_coins BIGINT DEFAULT 0,
    experience BIGINT DEFAULT 0,
    is_vip BOOLEAN DEFAULT FALSE,
    vip_expire_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_users_level ON users(level);
CREATE INDEX idx_users_wechat ON users(wechat_openid);
```

#### 2. é“å…·æ¨¡æ¿è¡¨ (item_templates)

```sql
CREATE TABLE item_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    category VARCHAR(20) NOT NULL CHECK (category IN ('miner', 'cart', 'raider', 'shield')),
    description TEXT,
    icon_url VARCHAR(255),
    max_level INT DEFAULT 10,
    upgrade_formula JSONB, -- å‡çº§é…ç½®
    created_at TIMESTAMP DEFAULT NOW()
);

-- æ’å…¥åˆå§‹é“å…·æ¨¡æ¿
INSERT INTO item_templates (name, category, description, max_level, upgrade_formula) VALUES
('é’é“œçŸ¿æœº', 'miner', 'åŸºç¡€æŒ–çŸ¿è®¾å¤‡', 10, '{
  "1": {"materials": {"ore": 100, "coins": 500}, "success_rate": 0.95},
  "2": {"materials": {"ore": 200, "coins": 1000}, "success_rate": 0.90}
}'::jsonb),
('æœ¨åˆ¶çŸ¿è½¦', 'cart', 'è¿è¾“çŸ¿çŸ³çš„è½¦è¾†', 10, '{}'::jsonb),
('ç”Ÿé”ˆæ å¤ºå™¨', 'raider', 'æå‡æ å¤ºæ•ˆç‡', 10, '{}'::jsonb),
('æœ¨åˆ¶é˜²å¾¡ç›¾', 'shield', 'å‡å°‘è¢«æ å¤ºæŸå¤±', 10, '{}'::jsonb);
```

#### 3. ç”¨æˆ·é“å…·è¡¨ (user_items)

```sql
CREATE TABLE user_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    template_id UUID NOT NULL REFERENCES item_templates(id),
    level INT DEFAULT 1,
    is_equipped BOOLEAN DEFAULT FALSE,
    is_locked BOOLEAN DEFAULT FALSE, -- äº¤æ˜“ä¸­é”å®š
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_user_items_user ON user_items(user_id);
CREATE INDEX idx_user_items_equipped ON user_items(user_id, is_equipped);
```

#### 4. ç¢ç‰‡è¡¨ (user_fragments)

```sql
CREATE TABLE user_fragments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    template_id UUID NOT NULL REFERENCES item_templates(id),
    amount INT DEFAULT 0,
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, template_id)
);

CREATE INDEX idx_fragments_user ON user_fragments(user_id);
```

#### 5. æ å¤ºæ—¥å¿—è¡¨ (plunder_logs)

```sql
CREATE TABLE plunder_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    attacker_id UUID NOT NULL REFERENCES users(id),
    defender_id UUID NOT NULL REFERENCES users(id),
    resources_looted BIGINT NOT NULL,
    attacker_raider_level INT,
    defender_shield_level INT,
    is_revenge BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_plunder_attacker ON plunder_logs(attacker_id, created_at);
CREATE INDEX idx_plunder_defender ON plunder_logs(defender_id, created_at);
```

#### 6. äº¤æ˜“è®¢å•è¡¨ (exchange_orders)

```sql
CREATE TABLE exchange_orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    item_template_id UUID NOT NULL REFERENCES item_templates(id),
    type VARCHAR(10) NOT NULL CHECK (type IN ('buy', 'sell')),
    price INT NOT NULL,
    amount INT NOT NULL,
    filled_amount INT DEFAULT 0,
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'partial', 'filled', 'cancelled')),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_orders_matching ON exchange_orders(item_template_id, type, status, price);
CREATE INDEX idx_orders_user ON exchange_orders(user_id, created_at);
```

#### 7. äº¤æ˜“è®°å½•è¡¨ (exchange_trades)

```sql
CREATE TABLE exchange_trades (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    buy_order_id UUID NOT NULL REFERENCES exchange_orders(id),
    sell_order_id UUID NOT NULL REFERENCES exchange_orders(id),
    buyer_id UUID NOT NULL REFERENCES users(id),
    seller_id UUID NOT NULL REFERENCES users(id),
    item_template_id UUID NOT NULL REFERENCES item_templates(id),
    amount INT NOT NULL,
    price INT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_trades_item_time ON exchange_trades(item_template_id, created_at);
```

#### 8. æ’è¡Œæ¦œè¡¨ (season_rankings)

```sql
CREATE TABLE season_rankings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    season_id INT NOT NULL,
    user_id UUID NOT NULL REFERENCES users(id),
    rank INT NOT NULL,
    score BIGINT NOT NULL, -- çŸ¿çŸ³ç´¯è®¡äº§å‡º
    reward_claimed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(season_id, user_id)
);

CREATE INDEX idx_rankings_season ON season_rankings(season_id, rank);
```

### Redisæ•°æ®ç»“æ„è®¾è®¡

#### 1. ç”¨æˆ·ä¼šè¯
```
Key: user:{userId}
Type: String (JSON)
TTL: 1800s (30åˆ†é’Ÿ)
Value: å®Œæ•´ç”¨æˆ·ä¿¡æ¯
```

#### 2. çŸ¿è½¦å­˜å‚¨
```
Key: cart:{userId}
Type: String (æ•°å­—)
TTL: æ°¸ä¹…
Value: å½“å‰çŸ¿è½¦å­˜å‚¨é‡
```

#### 3. çŸ¿æ´åå¡ŒçŠ¶æ€
```
Key: collapse:{userId}
Type: String
TTL: 120s (åå¡ŒæŒç»­æ—¶é—´)
Value: "1"
```

#### 4. æ å¤ºå™¨å†·å´
```
Key: plunder_cd:{userId}
Type: String
TTL: 3600s (1å°æ—¶)
Value: "1"
```

#### 5. æ’è¡Œæ¦œ
```
Key: ranking:season:{seasonId}
Type: Sorted Set
Score: çŸ¿çŸ³ç´¯è®¡äº§å‡º
Member: userId
```

---

## APIæ¥å£è®¾è®¡

### RESTful APIè§„èŒƒ

**Base URL**: `https://api.yourgame.com/api`

**é€šç”¨å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

**é”™è¯¯å“åº”æ ¼å¼**:
```json
{
  "code": 400,
  "message": "é”™è¯¯æè¿°",
  "error": "ERROR_CODE"
}
```

### 1. è®¤è¯æ¥å£

#### POST /auth/login
ç”¨æˆ·ç™»å½•

**è¯·æ±‚ä½“**:
```json
{
  "username": "string",
  "password": "string"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "access_token": "eyJhbGc...",
    "user": {
      "id": "uuid",
      "username": "player1",
      "nickname": "ç©å®¶1",
      "level": 5
    }
  }
}
```

#### POST /auth/wechat-login
å¾®ä¿¡ç™»å½•

**è¯·æ±‚ä½“**:
```json
{
  "code": "å¾®ä¿¡æˆæƒcode"
}
```

### 2. ç”¨æˆ·æ¥å£

#### GET /user/profile
è·å–ç”¨æˆ·è¯¦æƒ…

**Headers**: `Authorization: Bearer {token}`

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "id": "uuid",
    "nickname": "ç©å®¶1",
    "level": 5,
    "ore_amount": 12450,
    "bb_coins": 5230,
    "is_vip": false
  }
}
```

### 3. æŒ–çŸ¿æ¥å£

#### POST /mine/collect
æ”¶çŸ¿

**è¯·æ±‚ä½“**:
```json
{
  "watched_ad": true
}
```

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "collected_amount": 850
  }
}
```

### 4. é“å…·æ¥å£

#### GET /items
è·å–èƒŒåŒ…é“å…·åˆ—è¡¨

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "items": [
      {
        "id": "uuid",
        "template_id": "uuid",
        "name": "é’é“œçŸ¿æœº",
        "category": "miner",
        "level": 5,
        "is_equipped": true
      }
    ]
  }
}
```

#### POST /items/upgrade
å‡çº§é“å…·

**è¯·æ±‚ä½“**:
```json
{
  "item_id": "uuid"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "success": true,
    "new_level": 6
  }
}
```

#### POST /items/compose
åˆæˆé“å…·

**è¯·æ±‚ä½“**:
```json
{
  "template_id": "uuid"
}
```

### 5. æ å¤ºæ¥å£

#### GET /plunder/targets
è·å–å¯æ å¤ºç›®æ ‡

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "targets": [
      {
        "id": "uuid",
        "nickname": "ç©å®¶2",
        "level": 6,
        "estimated_loot": 500
      }
    ]
  }
}
```

#### POST /plunder/{targetId}
æ‰§è¡Œæ å¤º

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "success": true,
    "loot_amount": 480,
    "can_revenge": true
  }
}
```

### 6. äº¤æ˜“æ‰€æ¥å£

#### GET /exchange/orders
æŸ¥è¯¢æŒ‚å•åˆ—è¡¨

**Queryå‚æ•°**:
- `item_template_id`: é“å…·æ¨¡æ¿ID
- `type`: buy/sell

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "orders": [
      {
        "id": "uuid",
        "type": "sell",
        "price": 1000,
        "amount": 5,
        "filled_amount": 0
      }
    ]
  }
}
```

#### POST /exchange/orders
æŒ‚å•

**è¯·æ±‚ä½“**:
```json
{
  "item_template_id": "uuid",
  "type": "buy",
  "price": 1000,
  "amount": 5
}
```

#### DELETE /exchange/orders/{orderId}
æ’¤å•

### WebSocketäº‹ä»¶

#### å®¢æˆ·ç«¯â†’æœåŠ¡ç«¯

æ— ä¸»åŠ¨å‘é€äº‹ä»¶ï¼ˆçº¯æ¨é€æ¨¡å¼ï¼‰

#### æœåŠ¡ç«¯â†’å®¢æˆ·ç«¯

| äº‹ä»¶å | æ•°æ®ç»“æ„ | è¯´æ˜ |
|-------|---------|------|
| mine.update | `{type: 'normal/critical', amount: 100}` | æŒ–çŸ¿äº§å‡º |
| mine.collapse | `{repair_duration: 120}` | çŸ¿æ´åå¡Œ |
| plunder.attacked | `{attacker: 'xxx', loss: 300}` | è¢«æ å¤ºé€šçŸ¥ |
| item.upgrade_success | `{player: 'xxx', item: 'xxx +10'}` | å…¨æœé“å…·å‡çº§å¹¿æ’­ |
| exchange.deal | `{type: 'buy', item: 'xxx', amount: 1, price: 1000}` | äº¤æ˜“æˆäº¤é€šçŸ¥ |

---

## å¼€å‘é˜¶æ®µè§„åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæŠ€æœ¯éªŒè¯ä¸æ ¸å¿ƒæ¡†æ¶ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ­å»ºå®Œæ•´çš„å‰åç«¯é¡¹ç›®æ¶æ„ï¼Œè·‘é€šæ ¸å¿ƒæµç¨‹

#### Week 1: åŸºç¡€è®¾æ–½æ­å»ºï¼ˆæœ¬åœ°å•æœºå¯è·‘é€šï¼‰

**å‰ç«¯ä»»åŠ¡**:
- [ ] åˆ›å»º Cocos é¡¹ç›® + ä¸»é¢˜è‰²/åŠé€æ˜åº•æ  + å­—ä½“æ¥å…¥
- [ ] æ ¸å¿ƒç®¡ç†å™¨ï¼ˆGameManager, NetworkManager, ThemeManagerï¼‰
- [ ] ç™»å½•ç•Œé¢ï¼ˆç»ç’ƒå¡ç‰‡ + éœ“è™¹è¾“å…¥æ¡†ï¼‰
- [ ] ä¸»ç•Œé¢åŸºç¡€å¡ç‰‡å¸ƒå±€ï¼ˆæ¸å˜+å‘å…‰ï¼‰

**åç«¯ä»»åŠ¡ï¼ˆç®€åŒ–ï¼Œå•æœºå¯ç”¨ï¼‰**:
- [ ] åˆå§‹åŒ– NestJS é¡¹ç›®ï¼ˆå·²å®Œæˆï¼‰
- [ ] ä»…å¯ç”¨ JWT + å†…å­˜ç”¨æˆ·å­˜å‚¨ï¼ˆå¯é€‰æ¥ Postgresï¼‰
- [ ] æä¾›æŒ–çŸ¿/é“å…·/æ å¤ºæœ€å° APIï¼ˆå·²å®Œæˆå†…å­˜ç‰ˆï¼‰

**æ•°æ®åº“ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰**:
- [ ] å¦‚éœ€æŒä¹…åŒ–å†å¼€å¯ DB_ENABLE å¹¶ç”Ÿæˆè¿ç§»

#### Week 2: æ ¸å¿ƒæµç¨‹æ‰“é€š

**å‰ç«¯ä»»åŠ¡**:
- [ ] æŒ–çŸ¿å¡ç‰‡ï¼šç¯å½¢è¿›åº¦+å®æ—¶æ•°å­—ï¼ˆCountUpï¼‰
- [ ] æ¥å…¥ WebSocketï¼šmine.update/mine.collapse â†’ UI å‘å…‰/å€’è®¡æ—¶
- [ ] æ”¶çŸ¿æ“ä½œï¼ˆæŒ‰é’®æ¶Ÿæ¼ª + Loadingï¼‰

**åç«¯ä»»åŠ¡**:
- [ ] å®ç°æŒ–çŸ¿æœåŠ¡ï¼ˆMineServiceï¼‰
- [ ] ä½¿ç”¨Bullé˜Ÿåˆ—æ¨¡æ‹ŸæŒ–çŸ¿äº§å‡º
- [ ] å®ç°æ”¶çŸ¿API
- [ ] æ­å»ºWebSocket Gatewayï¼Œæ¨é€æŒ–çŸ¿äº§å‡º

**æµ‹è¯•éªŒè¯**:
- [ ] ç™»å½•â†’å¼€å§‹æŒ–çŸ¿â†’æ¥æ”¶æ¨é€â†’æ”¶çŸ¿ å®Œæ•´æµç¨‹è·‘é€š
- [ ] æ•°æ®æŒä¹…åŒ–éªŒè¯
- [ ] æ€§èƒ½åˆæ­¥æµ‹è¯•ï¼ˆ100å¹¶å‘ç”¨æˆ·ï¼‰

---

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒå¾ªç¯å¼€å‘ï¼ˆ4å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®Œæˆä¸»ç•Œé¢ã€ä»“åº“ç•Œé¢ï¼Œå®ç°æŒ–çŸ¿ã€é“å…·ç³»ç»Ÿçš„å®Œæ•´åŠŸèƒ½

#### Week 3-4: ä¸»ç•Œé¢å®Œå–„ + é“å…·åŸºç¡€

**å‰ç«¯ä»»åŠ¡**:
- [ ] ç§‘æŠ€é£ä¸»ç•Œé¢å¡ç‰‡å¸ƒå±€ï¼ˆç´«è“æ¸å˜èƒŒæ™¯ï¼‰
- [ ] æš´å‡»/åå¡Œæ•ˆæœï¼ˆå¡ç‰‡å‘å…‰è„‰å†² + æ•°å­—æ”¾å¤§ï¼‰
- [ ] çŸ¿è½¦è¿›åº¦æ¡ä¼˜åŒ–ï¼ˆæ¸å˜å¡«å…… + å®æ—¶ç™¾åˆ†æ¯”ï¼‰
- [ ] ä»“åº“ç•Œé¢å¼€å‘ï¼ˆScrollView å¡ç‰‡åˆ—è¡¨ï¼‰
- [ ] é“å…·è¯¦æƒ…å¼¹çª—ï¼ˆåº•éƒ¨æŠ½å±‰åŠ¨ç”»ï¼‰

**åç«¯ä»»åŠ¡**:
- [ ] å®Œå–„æŒ–çŸ¿é€»è¾‘ï¼ˆæš´å‡»/åå¡Œæ¦‚ç‡ï¼‰
- [ ] å®ç°é“å…·æ¨¡å—åŸºç¡€CRUD
- [ ] å®ç°é“å…·è£…å¤‡/å¸è½½åŠŸèƒ½
- [ ] é“å…·å±æ€§åŠ æˆè®¡ç®—

**UI èµ„æº**:
- [ ] æ‰å¹³ç§‘æŠ€å›¾æ ‡ï¼ˆé“å…· 4 ç±»ï¼‰
- [ ] éœ“è™¹æè¾¹æ ·å¼ CSS
- [ ] æ¸å˜èƒŒæ™¯é…è‰²æ–¹æ¡ˆ

#### Week 5-6: åˆæˆå‡çº§ç³»ç»Ÿ

**å‰ç«¯ä»»åŠ¡**:
- [ ] é“å…·å‡çº§äº¤äº’æµç¨‹ï¼ˆæŒ‰é’®ç¦ç”¨çŠ¶æ€ï¼‰
- [ ] å‡çº§æˆåŠŸ/å¤±è´¥æ•ˆæœï¼ˆå¡ç‰‡è„‰å†² + éœ‡åŠ¨ï¼‰
- [ ] ææ–™ä¸è¶³æç¤ºï¼ˆToast åŠé€æ˜å¡ç‰‡ï¼‰
- [ ] ç¢ç‰‡ç³»ç»Ÿ UIï¼ˆè¿›åº¦æ¡ + æ•°å­—è®¡æ•°ï¼‰

**åç«¯ä»»åŠ¡**:
- [ ] å®ç°é“å…·å‡çº§é€»è¾‘ï¼ˆå«æˆåŠŸç‡è®¡ç®—ï¼‰
- [ ] å®ç°ç¢ç‰‡åˆæˆé€»è¾‘
- [ ] ææ–™æ‰£é™¤çš„åŸå­æ€§ä¿è¯
- [ ] é«˜ç­‰çº§é“å…·å…¨æœå¹¿æ’­

**é…ç½®æ•°æ®**:
- [ ] è®¾è®¡å®Œæ•´çš„å‡çº§å…¬å¼è¡¨
- [ ] è°ƒæ•´æˆåŠŸç‡æ›²çº¿
- [ ] è®¾è®¡ç¢ç‰‡äº§å‡ºè§„åˆ™

**æµ‹è¯•éªŒè¯**:
- [ ] å®Œæ•´æ¸¸æˆå¾ªç¯ï¼šæŒ–çŸ¿â†’æ”¶çŸ¿â†’å‡çº§é“å…·â†’æå‡äº§å‡º
- [ ] å‹åŠ›æµ‹è¯•ï¼š1000ç”¨æˆ·åŒæ—¶å‡çº§é“å…·
- [ ] è¾¹ç•Œæµ‹è¯•ï¼šææ–™ä¸è¶³ã€æ»¡çº§å‡çº§ç­‰

---

### ç¬¬ä¸‰é˜¶æ®µï¼šæ‰©å±•ç©æ³•å¼€å‘ï¼ˆ4å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®Œæˆæ å¤ºã€äº¤æ˜“æ‰€ç­‰æ‰©å±•ç©æ³•

#### Week 7-8: æ å¤ºç³»ç»Ÿ

**å‰ç«¯ä»»åŠ¡**:
- [ ] æ å¤ºç•Œé¢UIå¼€å‘
- [ ] æ å¤ºç›®æ ‡åˆ—è¡¨
- [ ] æ å¤ºæˆ˜æ–—åŠ¨ç”»ï¼ˆç®€åŒ–ç‰ˆï¼‰
- [ ] ç»“ç®—å¼¹çª—
- [ ] è¢«æ å¤ºé€šçŸ¥å¼¹çª—

**åç«¯ä»»åŠ¡ï¼ˆæœ¬åœ°æœ€å°ï¼‰**:
- [ ] ç›®æ ‡åˆ—è¡¨ï¼ˆåŸºäºå†…å­˜ç”¨æˆ·ï¼‰
- [ ] æ å¤ºæ‰§è¡Œï¼ˆç®€å•å…¬å¼ã€å†·å´ã€é€šçŸ¥ï¼‰

**å¯é€‰æ‰©å±•**:
- [ ] æ å¤ºæ—¥å¿—è®°å½•ï¼ˆæ•°æ®åº“ï¼‰
- [ ] å¤ä»‡ç³»ç»Ÿï¼ˆRedis è¿‡æœŸï¼‰

**æ•°æ®åº“ä»»åŠ¡**:
- [ ] åˆ›å»ºplunder_logsè¡¨
- [ ] ä¼˜åŒ–ç”¨æˆ·æŸ¥è¯¢ç´¢å¼•

#### Week 9-10: äº¤æ˜“æ‰€ç³»ç»Ÿ

**å‰ç«¯ä»»åŠ¡**:
- [ ] äº¤æ˜“æ‰€ç•Œé¢UIï¼ˆå¤šTabåˆ‡æ¢ï¼‰
- [ ] æŒ‚å•åˆ—è¡¨å±•ç¤º
- [ ] æŒ‚ä¹°å•/å–å•å¼¹çª—
- [ ] æˆ‘çš„è®¢å•ç®¡ç†
- [ ] ä»·æ ¼èµ°åŠ¿å›¾ï¼ˆå¯é€‰ï¼‰

**åç«¯ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰**:
- [ ] å®ç°è®¢å• CRUD ä¸æ’®åˆå¼•æ“
- [ ] äº¤æ˜“åŸå­æ€§ä¸å†å²è®°å½•
- [ ] è¡Œæƒ…æ•°æ®è®¡ç®—

**æ•°æ®åº“ä»»åŠ¡**:
- [ ] åˆ›å»ºexchange_ordersã€exchange_tradesè¡¨
- [ ] ä¼˜åŒ–æ’®åˆæŸ¥è¯¢ç´¢å¼•
- [ ] è®¾è®¡è®¢å•çŠ¶æ€æœº

**æµ‹è¯•éªŒè¯**:
- [ ] æ’®åˆé€»è¾‘æ­£ç¡®æ€§æµ‹è¯•
- [ ] å¹¶å‘äº¤æ˜“å‹åŠ›æµ‹è¯•
- [ ] èµ„æºè½¬ç§»åŸå­æ€§éªŒè¯
- [ ] è¾¹ç•Œæƒ…å†µï¼šæ’¤å•ã€éƒ¨åˆ†æˆäº¤ç­‰

#### Week 10: æ’è¡Œæ¦œä¸èµ›å­£åˆ¶

**å‰ç«¯ä»»åŠ¡**:
- [ ] æ’è¡Œæ¦œç•Œé¢UI
- [ ] æ’è¡Œæ¦œæ•°æ®åˆ·æ–°

**åç«¯ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰**:
- [ ] Redis æ’è¡Œæ¦œ/èµ›å­£é‡ç½®/å¥–åŠ±å‘æ”¾

---

### ç¬¬å››é˜¶æ®µï¼šä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆ3å‘¨ï¼‰

**ç›®æ ‡**ï¼šå…¨é¢ä¼˜åŒ–ã€æµ‹è¯•ã€å‡†å¤‡ä¸Šçº¿

#### Week 11: UI/UXä¼˜åŒ–

**å‰ç«¯ä»»åŠ¡**:
- [ ] å…¨å±€ç§‘æŠ€é£ç»Ÿä¸€ï¼ˆç´«è“é…è‰² + éœ“è™¹æè¾¹ï¼‰
- [ ] éŸ³æ•ˆé›†æˆï¼ˆæŒ‰é’®ç‚¹å‡»ã€æš´å‡»ã€å‡çº§æˆåŠŸç­‰ï¼Œå¯é€‰ï¼‰
- [ ] æ–°æ‰‹å¼•å¯¼æµç¨‹ï¼ˆè’™å±‚é«˜äº® + ç®­å¤´æŒ‡ç¤ºï¼‰
- [ ] åŠ è½½åŠ¨ç”»ä¼˜åŒ–ï¼ˆåœ†ç¯è¿›åº¦ + æ¸å˜æ—‹è½¬ï¼‰
- [ ] é€‚é…ä¸åŒåˆ†è¾¨ç‡ï¼ˆå“åº”å¼å¸ƒå±€ï¼‰

**UI èµ„æº**:
- [ ] æœ€ç»ˆé…è‰²æ–¹æ¡ˆç¡®å®šï¼ˆæ¸å˜è‰²å€¼ï¼‰
- [ ] éœ“è™¹æè¾¹ä¸é˜´å½± CSS æ ·å¼
- [ ] æ‰å¹³å›¾æ ‡åº“ï¼ˆSVG æˆ– PNGï¼‰

#### Week 12: æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨åŠ å›º

**å‰ç«¯ä¼˜åŒ–**:
- [ ] èµ„æºé¢„åŠ è½½ä¼˜åŒ–
- [ ] å†…å­˜æ³„æ¼æ’æŸ¥
- [ ] ç½‘ç»œè¯·æ±‚ä¼˜åŒ–ï¼ˆåˆå¹¶ã€ç¼“å­˜ï¼‰
- [ ] åŒ…ä½“å¤§å°ä¼˜åŒ–

**åç«¯ä¼˜åŒ–**:
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆæ…¢æŸ¥è¯¢æ’æŸ¥ï¼‰
- [ ] Redisç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- [ ] APIé™æµï¼ˆé˜²åˆ·ï¼‰
- [ ] æ•æ„Ÿæ“ä½œæ—¥å¿—å®¡è®¡

**å®‰å…¨åŠ å›º**:
- [ ] é˜²æ­¢å®¢æˆ·ç«¯ä½œå¼Šï¼ˆæ‰€æœ‰è®¡ç®—åœ¨æœåŠ¡ç«¯ï¼‰
- [ ] APIç­¾åéªŒè¯
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] XSSé˜²æŠ¤

#### Week 13: å…¨é¢æµ‹è¯•

**åŠŸèƒ½æµ‹è¯•**:
- [ ] å®Œæ•´åŠŸèƒ½å›å½’æµ‹è¯•
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] å¼‚å¸¸æµç¨‹æµ‹è¯•

**æ€§èƒ½æµ‹è¯•**:
- [ ] å‹åŠ›æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿ10000åœ¨çº¿ç”¨æˆ·ï¼‰
- [ ] æ¥å£å“åº”æ—¶é—´æµ‹è¯•
- [ ] æ•°æ®åº“è¿æ¥æ± æµ‹è¯•

**å…¼å®¹æ€§æµ‹è¯•**:
- [ ] iOS Safariæµ‹è¯•
- [ ] Android Chromeæµ‹è¯•
- [ ] å¾®ä¿¡å†…ç½®æµè§ˆå™¨æµ‹è¯•
- [ ] ä¸åŒå±å¹•å°ºå¯¸æµ‹è¯•

**Bugä¿®å¤**:
- [ ] æ”¶é›†å¹¶ä¿®å¤æµ‹è¯•æœŸé—´å‘ç°çš„æ‰€æœ‰Bug

---

## éƒ¨ç½²ä¸è¿ç»´ï¼ˆæœ¬åœ°ä¸ºä¸»ï¼Œä»¥ä¸‹ä¸ºå¯é€‰å‚è€ƒï¼‰

### 1. éƒ¨ç½²æ¶æ„

```
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   CDN/OSS   â”‚ â† é™æ€èµ„æº
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        â†“                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â”‚   Nginx (åå‘ä»£ç†)  â”‚             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                        â”‚                        â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚        â†“               â†“               â†“       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Node.jsâ”‚     â”‚ Node.jsâ”‚     â”‚ Node.jsâ”‚   â”‚  åç«¯æœåŠ¡é›†ç¾¤
â”‚   â”‚ Server â”‚     â”‚ Server â”‚     â”‚ Server â”‚   â”‚  (PM2ç®¡ç†)
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                        â”‚                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â”‚   PostgreSQL     â”‚              â”‚
â”‚              â”‚   (ä¸»ä»å¤åˆ¶)      â”‚              â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                        â”‚                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â”‚  Redis Cluster   â”‚              â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. éƒ¨ç½²æ¸…å•

#### å‰ç«¯éƒ¨ç½²ï¼ˆæœ¬åœ°ï¼‰
```bash
# æœ¬åœ°è°ƒè¯•ç›´æ¥ä½¿ç”¨ Cocos é¢„è§ˆ/æœ¬åœ°é™æ€æœåŠ¡å™¨
npm run build # å¦‚éœ€äº§ç‰©
```

#### åç«¯éƒ¨ç½²ï¼ˆæœ¬åœ°ï¼‰
```bash
# å¼€å‘æ¨¡å¼
npm install
npm run start:dev
```

> ç”Ÿäº§çº§éƒ¨ç½²ï¼ˆNginx/CDN/PM2/ä¸»ä»/é›†ç¾¤ç­‰ï¼‰ä¸ºå¯é€‰å†…å®¹ï¼Œä¸å½±å“æœ¬åœ°åŠŸèƒ½éªŒè¯ã€‚

### 3. ç›‘æ§ä¸æ—¥å¿—

**ç›‘æ§æŒ‡æ ‡**:
- APIå“åº”æ—¶é—´
- æ•°æ®åº“è¿æ¥æ•°
- æœåŠ¡å™¨CPU/å†…å­˜ä½¿ç”¨ç‡
- åœ¨çº¿ç”¨æˆ·æ•°
- é”™è¯¯ç‡

**æ—¥å¿—æ”¶é›†**:
- åº”ç”¨æ—¥å¿—ï¼ˆWinstonï¼‰
- è®¿é—®æ—¥å¿—ï¼ˆNginxï¼‰
- é”™è¯¯æ—¥å¿—é›†ä¸­å­˜å‚¨

### 4. è¿ç»´è„šæœ¬

**æ•°æ®åº“å¤‡ä»½**:
```bash
#!/bin/bash
# backup-db.sh
pg_dump mining_game > backup_$(date +%Y%m%d).sql
# ä¸Šä¼ åˆ°OSS
```

**èµ›å­£é‡ç½®**:
```bash
# å®šæ—¶ä»»åŠ¡ï¼šæ¯æœˆ1å·å‡Œæ™¨æ‰§è¡Œ
0 0 1 * * /usr/local/bin/reset-season.sh
```

---

## é™„å½•

### A. å…³é”®é…ç½®å‚æ•°

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|-------|---|------|
| æŒ–çŸ¿åŸºç¡€é—´éš” | 60ç§’ | çŸ¿æœºæ¯çº§-2ç§’ |
| æš´å‡»æ¦‚ç‡ | 25% | 3å€äº§å‡º |
| åå¡Œæ¦‚ç‡ | 5% | åœå·¥2åˆ†é’Ÿ |
| çŸ¿è½¦åŸºç¡€å®¹é‡ | 1000 | çŸ¿è½¦æ¯çº§+1000 |
| æ å¤ºå™¨å†·å´ | 1å°æ—¶ | VIPå‡åŠ |
| æ å¤ºåŸºç¡€æˆåŠŸç‡ | 10% | è£…å¤‡å½±å“Â±5% |
| é“å…·å‡çº§åŸºç¡€æˆåŠŸç‡ | 80% | æ¯çº§-5% |

### B. æŠ€æœ¯é€‰å‹æ›¿ä»£æ–¹æ¡ˆ

| åŸæ–¹æ¡ˆ | æ›¿ä»£æ–¹æ¡ˆ | è¯´æ˜ |
|-------|---------|------|
| Cocos Creator | Phaser.js | æ›´è½»é‡çš„H5æ¸¸æˆå¼•æ“ |
| NestJS | Express.js | æ›´è½»é‡ï¼Œä½†éœ€è‡ªè¡Œæ­å»ºæ¶æ„ |
| PostgreSQL | MySQL | æ›´å¸¸è§ï¼Œä½†JSONæ”¯æŒè¾ƒå¼± |
| Bull | Bee-Queue | æ›´è½»é‡çš„é˜Ÿåˆ—åº“ |

### C. å¼€å‘è§„èŒƒ

**ä»£ç è§„èŒƒ**:
- ä½¿ç”¨ESLint + Prettier
- éµå¾ªAirbnbç¼–ç é£æ ¼
- æäº¤å‰æ‰§è¡Œlintæ£€æŸ¥

**Gitå·¥ä½œæµ**:
- mainåˆ†æ”¯ï¼šç”Ÿäº§ç¯å¢ƒ
- developåˆ†æ”¯ï¼šå¼€å‘ç¯å¢ƒ
- feature/*åˆ†æ”¯ï¼šåŠŸèƒ½å¼€å‘
- ä½¿ç”¨Pull Requestè¿›è¡Œä»£ç å®¡æŸ¥

**å‘½åè§„èŒƒ**:
- å˜é‡/å‡½æ•°ï¼šcamelCase
- ç±»/æ¥å£ï¼šPascalCase
- å¸¸é‡ï¼šUPPER_SNAKE_CASE
- æ–‡ä»¶åï¼škebab-case



